<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
      <meta name="robots" content="noindex">

    <title>The Cloud Platform CLI - Cloud Platform User Guide</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://user-guide.cloud-platform.service.justice.gov.uk/documentation/getting-started/cloud-platform-cli.html">


      <meta property="og:image" content="https://user-guide.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="Cloud Platform User Guide" />
      <meta property="og:title" content="The Cloud Platform CLI" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://user-guide.cloud-platform.service.justice.gov.uk/documentation/getting-started/cloud-platform-cli.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="user-guide.cloud-platform.service.justice.gov.uk" />
      <meta property="twitter:image" content="https://user-guide.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="The Cloud Platform CLI - Cloud Platform User Guide" />
      <meta property="twitter:url" content="https://user-guide.cloud-platform.service.justice.gov.uk/documentation/getting-started/cloud-platform-cli.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          Cloud Platform User Guide
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="mailto:platforms+user-guide@digital.justice.gov.uk?subject=User+guide+feedback">Feedback / Report a problem</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Documentation</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://github.com/ministryofjustice/cloud-platform-user-guide">GitHub</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://user-guide.cloud-platform.service.justice.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                      <ul>
  <li>
    <a href="#the-cloud-platform-cli"><span>The Cloud Platform CLI</span></a>
    <ul>
      <li>
        <a href="#installation"><span>Installation</span></a>
        <ul>
          <li>
            <a href="#auto-update"><span>Auto-update</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#functions"><span>Functions</span></a>
        <ul>
          <li>
            <a href="#create-an-environment"><span>Create an environment</span></a>
          </li>
          <li>
            <a href="#add-an-ecr-to-your-namespace"><span>Add an ECR to your namespace</span></a>
          </li>
          <li>
            <a href="#add-an-rds-to-your-namespace"><span>Add an RDS to your namespace</span></a>
          </li>
          <li>
            <a href="#add-an-s3-bucket-to-your-namespace"><span>Add an S3 Bucket to your namespace</span></a>
          </li>
          <li>
            <a href="#add-a-service-account-to-your-namespace"><span>Add a service account to your namespace</span></a>
          </li>
          <li>
            <a href="#check-your-kubernetes-config-file"><span>Check your kubernetes config file</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <h1 id="the-cloud-platform-cli">The Cloud Platform CLI</h1><p>The <a href="https://github.com/ministryofjustice/cloud-platform-cli#cloud-platform-tool-cli">cloud platform cli</a> is a command-line tool to help you work with the cloud
platform.</p>
<p>The idea is to enable you to manage resources in your environment without
always needing to craft your terraform or kubernetes yaml files by hand, and to
simplify some common tasks (like checking the github teams in your kube config
file).</p>
<h2 id="installation">Installation</h2><p>The CLI tool is written in <a href="https://golang.org">golang</a>, and packaged as a single <code>cloud-platform</code>
binary. You can get the latest version from the <a href="https://github.com/ministryofjustice/cloud-platform-cli#cloud-platform-tool-cli/releases">releases</a> page of the github
repository. Download whichever tarball is appropriate for your development
environment, unpack it and put the <code>cloud-platform</code> binary somewhere on your
<code>$PATH</code></p>
<p>If you&rsquo;re on a Mac, you can do this by running the following commands:</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">LATEST</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">--silent</span> https://github.com/ministryofjustice/cloud-platform-cli/releases/latest | <span class="nb">sed</span> <span class="s1">'s/.*releases.tag.\(.*\)".*/\1/'</span><span class="si">)</span>
<span class="nv">TARBALL</span><span class="o">=</span><span class="s2">"cloud-platform-cli_</span><span class="k">${</span><span class="nv">LATEST</span><span class="k">}</span><span class="s2">_darwin_amd64.tar.gz"</span>
wget https://github.com/ministryofjustice/cloud-platform-cli/releases/download/<span class="k">${</span><span class="nv">LATEST</span><span class="k">}</span>/<span class="k">${</span><span class="nv">TARBALL</span><span class="k">}</span>
<span class="nb">tar </span>xzf <span class="k">${</span><span class="nv">TARBALL</span><span class="k">}</span>
<span class="nb">mv </span>cloud-platform /usr/local/bin
<span class="nb">rm</span> <span class="k">${</span><span class="nv">TARBALL</span><span class="k">}</span>
</code></pre></div><p>After this, you should be able to run:</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>cloud-platform version
</code></pre></div><p>&hellip;to confirm that your installation is working.</p>
<h3 id="auto-update">Auto-update</h3><p>The <code>cloud-platform</code> binary will update itself whenever it detects a new
version, so you should only ever have to install it once.</p>
<h2 id="functions">Functions</h2><p>This describes the current capabilities of the CLI tool.</p>

<ul>
<li><a href="#create-an-environment">Create an environment</a></li>
<li><a href="#add-an-ecr-to-your-namespace">Add an ECR to your namespace</a></li>
<li><a href="#add-an-rds-to-your-namespace">Add an RDS to your namespace</a></li>
<li><a href="#add-an-s3-bucket-to-your-namespace">Add an S3 Bucket to your namespace</a></li>
<li><a href="#add-a-service-account-to-your-namespace">Add a service account to your namespace</a></li>
<li><a href="#check-your-kubernetes-config-file">Check your kubernetes config file</a></li>
</ul>
<h3 id="create-an-environment">Create an environment</h3>
<ul>
<li>Start from the root of a working copy of the <a href="https://github.com/ministryofjustice/cloud-platform-environments">environments repository</a></li>
<li>Create a new branch</li>
<li><p>Run <code>cloud-platform environment create</code></p>
<p>You will be prompted to answer some questions about the environment (i.e.
namespace) that you are creating. Once the process is complete, you will
have a new <a href="https://github.com/ministryofjustice/cloud-platform-environments/tree/main/namespaces/live-1.cloud-platform.service.justice.gov.uk">namespace folder</a> in your working copy.</p></li>
<li><p><code>git add</code> and <code>git commit</code> the new files, and raise a PR</p></li>
</ul>
<p>After the cloud platform team have approved your PR, please merge it, and your
namespace will be created a few minutes later.</p>

<blockquote>
<p>The other <code>cloud-platform environment ...</code> commands, which manage resources
in your namespace, all assume that your namespace conforms to the templates
generated by this command.</p>
</blockquote>
<h3 id="add-an-ecr-to-your-namespace">Add an ECR to your namespace</h3>
<ul>
<li>Start from the root of a working copy of the <a href="https://github.com/ministryofjustice/cloud-platform-environments">environments repository</a></li>
<li>Create a new branch</li>
<li><code>cd</code> into your <a href="https://github.com/ministryofjustice/cloud-platform-environments/tree/main/namespaces/live-1.cloud-platform.service.justice.gov.uk">namespace folder</a></li>
<li><p>Run <code>cloud-platform environment ecr create</code></p>
<p>This will create a <code>resources/ecr.tf</code> file in your working copy.</p></li>
<li><p><code>git add</code> and <code>git commit</code> the new file, and raise a PR</p></li>
</ul>
<p>After the cloud platform team have approved your PR, please merge it, and your
ECR will be created a few minutes later.</p>
<p>When your ECR has been created, you will see a new kubernetes secret in your
namespace called <code>ecr-repo-[namespace name]</code>. This secret contains the
credentials you will need in order to use your ECR.</p>

<blockquote>
<p>The CLI tool assumes you already have a <code>resources/variables.tf</code> file below
your namespace folder, and that this defines all the variables which appear in
the template <code>ecr.tf</code> file. If this is not the case, you may need to amend the
generated file.</p>
</blockquote>
<h3 id="add-an-rds-to-your-namespace">Add an RDS to your namespace</h3>
<ul>
<li>Start from the root of a working copy of the <a href="https://github.com/ministryofjustice/cloud-platform-environments">environments repository</a></li>
<li>Create a new branch</li>
<li><code>cd</code> into your <a href="https://github.com/ministryofjustice/cloud-platform-environments/tree/main/namespaces/live-1.cloud-platform.service.justice.gov.uk">namespace folder</a></li>
<li><p>Run <code>cloud-platform environment rds create</code></p>
<p>This will create a <code>resources/rds.tf</code> file in your working copy.</p></li>
<li><p><code>git add</code> and <code>git commit</code> the new file, and raise a PR</p></li>
</ul>
<p>After the cloud platform team have approved your PR, please merge it, and your
RDS will be created a little while later (it usually takes about 20 minutes for
an RDS instance to be created).</p>
<p>When your RDS has been created, you will see a new kubernetes secret in your
namespace called <code>rds-instance-output</code>. This secret contains the credentials
you will need in order to access your database.</p>

<blockquote>
<p>The CLI tool assumes you already have a <code>resources/variables.tf</code> file below
your namespace folder, and that this defines all the variables which appear in
the template <code>rds.tf</code> file. If this is not the case, you may need to amend the
generated file.</p>
</blockquote>
<h3 id="add-an-s3-bucket-to-your-namespace">Add an S3 Bucket to your namespace</h3>
<ul>
<li>Start from the root of a working copy of the <a href="https://github.com/ministryofjustice/cloud-platform-environments">environments repository</a></li>
<li>Create a new branch</li>
<li><code>cd</code> into your <a href="https://github.com/ministryofjustice/cloud-platform-environments/tree/main/namespaces/live-1.cloud-platform.service.justice.gov.uk">namespace folder</a></li>
<li><p>Run <code>cloud-platform environment s3 create</code></p>
<p>This will create a <code>resources/s3.tf</code> file in your working copy.</p></li>
<li><p><code>git add</code> and <code>git commit</code> the new file, and raise a PR</p></li>
</ul>
<p>After the cloud platform team have approved your PR, please merge it, and your
S3 bucket will be created a little while later.</p>
<p>When your S3 bucket has been created, you will see a new kubernetes secret in your
namespace called <code>s3</code>. This secret contains the credentials
you will need in order to access your s3 bucket.</p>

<blockquote>
<p>The CLI tool assumes you already have a <code>resources/variables.tf</code> file below
your namespace folder, and that this defines all the variables which appear in
the template <code>s3.tf</code> file. If this is not the case, you may need to amend the
generated file.</p>
</blockquote>
<h3 id="add-a-service-account-to-your-namespace">Add a service account to your namespace</h3>
<ul>
<li>Start from the root of a working copy of the <a href="https://github.com/ministryofjustice/cloud-platform-environments">environments repository</a></li>
<li>Create a new branch</li>
<li><code>cd</code> into your <a href="https://github.com/ministryofjustice/cloud-platform-environments/tree/main/namespaces/live-1.cloud-platform.service.justice.gov.uk">namespace folder</a></li>
<li><p>Run <code>cloud-platform environment serviceaccount create</code></p>
<p>This will create a <code>05-serviceaccount.yaml</code> file in your working copy.</p></li>
<li><p><code>git add</code> and <code>git commit</code> the new file, and raise a PR</p></li>
</ul>
<p>By default your service account name will be <code>cloud-platform-user</code>. If you&rsquo;d like to specify the name of your service account resource, you can use the <code>-n</code> or <code>--name</code> flag followed by the name of your choice.</p>
<p>After the cloud platform team have approved your PR, please merge it, and your
service account resource will be created.</p>
<p>You can query your new resource using the command <code>kubectl get serviceaccount -n &lt;namespace&gt;</code>.</p>
<h3 id="check-your-kubernetes-config-file">Check your kubernetes config file</h3><p>You can use the CLI tool to verify the github teams listed in your <code>id-token</code>
in your <code>~/.kube/config</code> file. Missing github teams are sometimes a reason why
people are unable to access objects in their namespaces.</p>
<p>To check your kube config id-token, run this command:</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>cloud-platform kubecfg id-token-claims
</code></pre></div><p>You should see output similar to this:</p>
<div class="highlight"><pre class="highlight shell"><code><span class="o">{</span>
        <span class="s2">"aud"</span>: <span class="s2">"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span>,
        <span class="s2">"email"</span>: <span class="s2">"david@whatever.com"</span>,
        <span class="s2">"email_verified"</span>: <span class="nb">true</span>,
        <span class="s2">"exp"</span>: 9999999999,
        <span class="s2">"https://k8s.integration.dsd.io/groups"</span>: <span class="o">[</span>
                <span class="s2">"github:webops"</span>,
                <span class="s2">"github:technical-architects"</span>,
                <span class="s2">"github:moj-cjse"</span>
        <span class="o">]</span>,
        <span class="s2">"iat"</span>: 9999999999,
        <span class="s2">"iss"</span>: <span class="s2">"https://justice-cloud-platform.eu.auth0.com/"</span>,
        <span class="s2">"name"</span>: <span class="s2">"David Salgado"</span>,
        <span class="s2">"nickname"</span>: <span class="s2">"digitalronin"</span>,
        <span class="s2">"picture"</span>: <span class="s2">"https://avatars2.githubusercontent.com/u/2338?v=4"</span>,
        <span class="s2">"sub"</span>: <span class="s2">"github|2338"</span>,
        <span class="s2">"updated_at"</span>: <span class="s2">"2020-04-27T09:44:33.971Z"</span>
<span class="o">}</span>
</code></pre></div><p>The github teams are listed under <code>https://k8s.integration.dsd.io/groups</code> as
above.</p>


              <div data-module='page-expiry' data-last-reviewed-on="2020-10-29">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 29 July 2020.

        It needs to be reviewed again on 29 October 2020
.
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 29 October 2020.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/ministryofjustice/cloud-platform-user-guide/blob/main/source/documentation/getting-started/cloud-platform-cli.html.md.erb">View source</a></li>
                <li><a href="https://github.com/ministryofjustice/cloud-platform-user-guide/issues/new?labels=bug&amp;title=Re:%20'The%20Cloud%20Platform%20CLI'&amp;body=Problem%20with%20'The%20Cloud%20Platform%20CLI'%20(https://user-guide.cloud-platform.service.justice.gov.uk/documentation/getting-started/cloud-platform-cli.html)">Report problem</a></li>
                <li><a href="https://github.com/ministryofjustice/cloud-platform-user-guide">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138188246-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138188246-1');
</script>

<script>
  // Add the current window.location to the body of the
  // feedback email message.
  function sendFeedback(mailto, event) {
    event.preventDefault();

    var body = "Feedback/Problem on page: " + window.location + "\n";
    var href = mailto + '&body=' + encodeURIComponent(body);

    window.location = href;
  }

  $(document).ready(function() {
    var feedbackLink = $('a[href^="mailto:"]:contains("Feedback")')[0];
    var mailto = feedbackLink.href;
    $(feedbackLink).on('click', function(event) { sendFeedback(mailto, event); });
  });
</script>
